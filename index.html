<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>منصة حصيف · Hasseef Platform — Leadership Demo</title>
<link rel="stylesheet" href="styles/theme.css"/>
<style>
.hero{padding:56px 0;background:linear-gradient(180deg, #ffffff 0%, #F7F9FC 100%)}
.brand{display:flex;align-items:center;gap:10px}
.brand span{font-weight:900}
.logo-grid{display:grid;gap:12px;grid-template-columns:repeat(6,minmax(0,1fr))}
.logo-box{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:12px;padding:8px;display:flex;align-items:center;justify-content:center}
.kpi-grid{display:grid;gap:12px;grid-template-columns:repeat(3,minmax(0,1fr))}
.tabbar{display:flex;flex-wrap:wrap;gap:8px}
.tabbar .tab{border:1px solid rgba(0,0,0,.12);border-radius:12px;padding:8px 12px;background:#fff;cursor:pointer;font-size:13px}
.tab.active{background:var(--green);color:#fff;border-color:var(--green)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
.modal .dialog{background:#fff;border-radius:16px;padding:18px;max-width:520px;width:100%}
.modal.show{display:flex}
@media (max-width:768px){ .grid-3{grid-template-columns:1fr} .kpi-grid{grid-template-columns:1fr} .logo-grid{grid-template-columns:repeat(3,1fr)} }
</style>
</head>
<body>
<header>
  <div class="container" style="display:flex;align-items:center;gap:12px;justify-content:space-between;padding:10px 0;">
    <div class="brand">
      <img class="logo" src="assets/logos/hasseef.png" alt="حصيف"/>
      <span>منصة حصيف</span>
    </div>
    <nav style="display:flex;align-items:center;gap:10px">
      <a href="#overview" data-i="nav_overview">نظرة عامة</a>
      <a href="#accounts" data-i="nav_accounts">الحسابات</a>
      <a href="#partners" data-i="nav_partners">الشركاء</a>
      <a href="#dashboard" data-i="nav_dashboard">لوحة</a>
      <a href="mailto:info@talbiya.sa" class="btn">info@talbiya.sa</a>
      <div class="lang-toggle">
        <button id="lang-ar" class="active">عربي</button>
        <button id="lang-en">EN</button>
      </div>
    </nav>
  </div>
</header>

<section class="hero" id="overview">
  <div class="container">
    <div class="grid grid-2" style="align-items:center">
      <div>
        <h1 data-i="hero_title">منصة حصيف — الممكن الوطني للشراكات والأثر</h1>
        <p style="color:var(--gray)" data-i="hero_sub">
          نموذج قيادي تفاعلي يبرز قيمة المنصة ضمن مستهدفات رؤية 2030 ويعرض الحسابات والخدمات والمؤشرات الحية.
        </p>
        <div style="display:flex;gap:8px;margin-top:10px">
          <a href="#dashboard" class="btn btn-primary" data-i="cta_open_dashboard">افتح اللوحة</a>
          <button id="toggleHC" class="btn" data-i="cta_high_contrast">تباين مرتفع</button>
        </div>
        <div style="margin-top:14px">
          <small data-i="hero_note">هذا النموذج يعمل محليًا دون اتصال ويصلح للعرض الرسمي.</small>
        </div>
      </div>
      <div class="card">
        <div class="kpi-grid">
          <div class="kpi">
            <div class="caption" data-i="kpi1">نمو التوظيف</div>
            <div class="value" id="kpi-employment">+18%</div>
            <div class="progress"><div class="bar" id="bar-1" style="width:62%"></div></div>
          </div>
          <div class="kpi">
            <div class="caption" data-i="kpi2">تكامل الشركاء</div>
            <div class="value" id="kpi-integration">92%</div>
            <div class="progress"><div class="bar" id="bar-2" style="width:50%"></div></div>
          </div>
          <div class="kpi">
            <div class="caption" data-i="kpi3">مشاريع مدعومة</div>
            <div class="value" id="kpi-projects">1,240</div>
            <div class="progress"><div class="bar" id="bar-3" style="width:40%"></div></div>
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <label data-i="profile_label">المنظور:</label>
          <select id="kpiProfile">
            <option value="national">وطني</option>
            <option value="hail">منطقة حائل</option>
            <option value="private">القطاع الخاص</option>
            <option value="nonprofit">القطاع غير الربحي</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="container" id="accounts" style="padding:32px 0">
  <h2 style="margin-bottom:12px" data-i="acc_title">حسابات المنصة والخدمات</h2>
  <p style="color:var(--gray)" data-i="acc_sub">يعرض هذا القسم الحسابات (حسب الدور) والخدمات الرئيسة لكل حساب.</p>
  <div id="rolesGrid" class="grid grid-3"></div>
</section>

<section class="container" id="partners" style="padding:8px 0 24px">
  <h2 style="margin-bottom:12px" data-i="partners_title">الشركاء الاستراتيجيون</h2>
  <div class="logo-grid">
    <div class="logo-box"><img src="assets/logos/Vision 2030.png" class="logo" alt="Vision 2030"/></div>
    <div class="logo-box"><img src="assets/logos/hasseef.png" class="logo" alt="Hasseef"/></div>
    <div class="logo-box"><img src="assets/logos/talbiya.png" class="logo" alt="Talbiya"/></div>
    <div class="logo-box"><span style="opacity:.6">NPOC</span></div>
    <div class="logo-box"><span style="opacity:.6">Adaa</span></div>
    <div class="logo-box"><span style="opacity:.6">Partners</span></div>
  </div>
</section>

<section id="dashboard" style="padding:32px 0 48px;background:#fff">
  <div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h2 data-i="dash_title">لوحتي</h2>
      <div><small data-i="dash_user">مرحبًا، <b id="userName">ضيف</b> · الدور: <b id="userRole">—</b></small></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div id="service-workspace" class="card" style="display:none;background:#fff"></div>

      <h3 style="margin:4px 0 10px" data-i="dash_services">خدمات الحساب</h3>
      <div id="role-services" class="grid grid-3"></div>
      <hr/>
      <div class="tabbar">
        <button class="tab active" data-tab="tab-overview" data-i="tab_overview">نظرة عامة</button>
        <button class="tab" data-tab="tab-initiatives" data-i="tab_initiatives">مبادراتي</button>
        <button class="tab" data-tab="tab-opps" data-i="tab_opps">فرص</button>
      </div>
      <div style="margin-top:12px">
        <div id="tab-overview">
          <div class="grid kpi-grid">
            <div class="card"><small data-i="dash_stat1">عدد المبادرات</small><div class="value" id="stat-initiatives">0</div></div>
            <div class="card"><small data-i="dash_stat2">طلبات قيد المراجعة</small><div class="value" id="stat-pending">0</div></div>
            <div class="card"><small data-i="dash_stat3">فرص مقترحة</small><div class="value" id="stat-opps">0</div></div>
          </div>
        </div>
        <div id="tab-initiatives" style="display:none">
          <form id="form-initiative" class="grid grid-2">
            <input placeholder="اسم المبادرة" required/>
            <select><option>تعليمي</option><option>ثقافي</option><option>اجتماعي</option><option>اقتصادي</option></select>
            <textarea class="grid-col-span-2" placeholder="وصف مختصر" required></textarea>
            <div class="grid grid-3">
              <input placeholder="الجمهور المستهدف"/>
              <input placeholder="القيمة المقترحة"/>
              <input placeholder="القنوات"/>
            </div>
            <button class="btn btn-primary" style="margin-top:6px" data-i="btn_save">حفظ</button>
          </form>
          <div style="margin-top:12px">
            <h3 data-i="list_title">قائمة المبادرات</h3>
            <div id="list-initiatives" class="grid"></div>
          </div>
        </div>
        <div id="tab-opps" style="display:none">
          <small style="color:var(--gray)" data-i="opps_note">(تجريبي) فرص مقترحة بناءً على دورك ومنطقتك.</small>
          <div id="list-opps" class="grid grid-2" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<footer class="container">
  <div style="display:flex;align-items:center;justify-content:space-between">
    <small>© 2025 Hasseef</small>
    <div style="display:flex;gap:8px">
      <button id="toggleTheme" class="btn">Dark</button>
      <button id="toggleHC2" class="btn">HC</button>
    </div>
  </div>
</footer>

<!-- Auth modals -->
<div id="modal-login" class="modal">
  <div class="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 data-i="login_title">تسجيل دخول</h3>
      <button class="btn" onclick="closeModal('modal-login')">×</button>
    </div>
    <form id="loginForm" class="grid">
      <input name="emailOrName" placeholder="البريد الإلكتروني أو الاسم" required/>
      <div class="grid grid-2">
        <input name="password" type="password" placeholder="كلمة المرور"/>
        <select name="role">
          <option value="individual">فرد</option>
          <option value="private">قطاع خاص</option>
          <option value="nonprofit">قطاع غير ربحي</option>
          <option value="university">جامعة</option>
          <option value="government">حكومة</option>
          <option value="emirate">إمارة</option>
          <option value="funder">مانح</option>
        </select>
      </div>
      <button class="btn btn-primary" data-i="btn_login">دخول</button>
    </form>
  </div>
</div>

<div id="modal-signup" class="modal">
  <div class="dialog">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 data-i="signup_title">تسجيل حساب</h3>
      <button class="btn" onclick="closeModal('modal-signup')">×</button>
    </div>
    <form id="signupForm" class="grid">
      <input name="name" placeholder="الاسم الكامل" required/>
      <input name="email" type="email" placeholder="البريد الإلكتروني" required/>
      <select name="role" required>
        <option value="individual">فرد</option>
        <option value="private">قطاع خاص</option>
        <option value="nonprofit">قطاع غير ربحي</option>
        <option value="university">جامعة</option>
        <option value="government">حكومة</option>
        <option value="emirate">إمارة</option>
        <option value="funder">مانح</option>
      </select>
      <input name="region" placeholder="المنطقة (اختياري)"/>
      <input name="password" type="password" placeholder="كلمة المرور" required/>
      <button class="btn btn-primary" data-i="btn_create">إنشاء حساب</button>
    </form>
  </div>
</div>

<script>
// i18n dictionary
const i18n = {
  ar:{
    nav_overview:"نظرة عامة", nav_accounts:"الحسابات", nav_partners:"الشركاء", nav_dashboard:"لوحة",
    hero_title:"منصة حصيف — الممكن الوطني للشراكات والأثر",
    hero_sub:"نموذج قيادي تفاعلي يبرز قيمة المنصة ضمن مستهدفات رؤية 2030 ويعرض الحسابات والخدمات والمؤشرات الحية.",
    cta_open_dashboard:"افتح اللوحة", cta_high_contrast:"تباين مرتفع",
    hero_note:"هذا النموذج يعمل محليًا دون اتصال ويصلح للعرض الرسمي.",
    kpi1:"نمو التوظيف", kpi2:"تكامل الشركاء", kpi3:"مشاريع مدعومة",
    profile_label:"المنظور:",
    acc_title:"حسابات المنصة والخدمات", acc_sub:"يعرض هذا القسم الحسابات (حسب الدور) والخدمات الرئيسة لكل حساب.",
    partners_title:"الشركاء الاستراتيجيون",
    dash_title:"لوحتي", dash_user:"مرحبًا، ",
    dash_services:"خدمات الحساب",
    tab_overview:"نظرة عامة", tab_initiatives:"مبادراتي", tab_opps:"فرص",
    dash_stat1:"عدد المبادرات", dash_stat2:"طلبات قيد المراجعة", dash_stat3:"فرص مقترحة",
    list_title:"قائمة المبادرات", opps_note:"(تجريبي) فرص مقترحة بناءً على دورك ومنطقتك.",
    login_title:"تسجيل دخول", btn_login:"دخول", signup_title:"تسجيل حساب", btn_create:"إنشاء حساب"
  },
  en:{
    nav_overview:"Overview", nav_accounts:"Accounts", nav_partners:"Partners", nav_dashboard:"Dashboard",
    hero_title:"Hasseef Platform — National Enabler for Partnerships & Impact",
    hero_sub:"A leadership-grade interactive demo highlighting value under Vision 2030 targets, with accounts, services, and live KPIs.",
    cta_open_dashboard:"Open Dashboard", cta_high_contrast:"High Contrast",
    hero_note:"This demo runs fully offline and is suitable for executive briefings.",
    kpi1:"Employment Growth", kpi2:"Partner Integration", kpi3:"Supported Projects",
    profile_label:"Profile:",
    acc_title:"Platform Accounts & Services", acc_sub:"Accounts (by role) and their primary services.",
    partners_title:"Strategic Partners",
    dash_title:"My Dashboard", dash_user:"Welcome, ",
    dash_services:"Account Services",
    tab_overview:"Overview", tab_initiatives:"My Initiatives", tab_opps:"Opportunities",
    dash_stat1:"Initiatives", dash_stat2:"Pending Requests", dash_stat3:"Suggested Opportunities",
    list_title:"Initiatives List", opps_note:"(Demo) Suggested opportunities by your role and region.",
    login_title:"Sign In", btn_login:"Sign In", signup_title:"Create Account", btn_create:"Create Account"
  }
};
let currentLang='ar';
function applyLang(lang){
  currentLang = lang;
  document.documentElement.lang = lang;
  document.documentElement.dir = (lang==='ar'?'rtl':'ltr');
  document.querySelectorAll('[data-i]').forEach(el=>{
    const key = el.getAttribute('data-i'); el.textContent = i18n[lang][key] || el.textContent;
  });
  document.getElementById('lang-ar').classList.toggle('active', lang==='ar');
  document.getElementById('lang-en').classList.toggle('active', lang==='en');
}
document.getElementById('lang-ar').onclick = ()=>applyLang('ar');
document.getElementById('lang-en').onclick = ()=>applyLang('en');

// Theme & HC
document.getElementById('toggleTheme').onclick = ()=> document.documentElement.classList.toggle('dark');
document.getElementById('toggleHC').onclick = ()=> document.documentElement.classList.toggle('hc');
document.getElementById('toggleHC2').onclick = ()=> document.documentElement.classList.toggle('hc');

// Modal helpers
function openModal(id){ document.getElementById(id).classList.add('show'); }
function closeModal(id){ document.getElementById(id).classList.remove('show'); }

// Simple auth (localStorage)
const App = {
  users: JSON.parse(localStorage.getItem('users')||'[]'),
  user: JSON.parse(localStorage.getItem('user')||'null'),
  opps: [{title:'تطوع في ملتقى الشباب', kind:'اجتماعي'},{title:'برنامج حاضنة مشاريع ناشئة', kind:'اقتصادي'},{title:'مبادرة نادي قرّاء الجامعات', kind:'تعليمي'}],
  save(){ localStorage.setItem('users', JSON.stringify(this.users)); localStorage.setItem('user', JSON.stringify(this.user)); }
};

function openLogin(){ openModal('modal-login'); }
function openSignup(){ openModal('modal-signup'); }

// Fill roles cards
fetch('data/Accounts.json').then(r=>r.json()).then(data=>{
  const grid = document.getElementById('rolesGrid');
  data.roles.forEach(role=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><b>${role.ar}</b> · <small>${role.en}</small></div>
        <span class="badge">Role</span>
      </div>
      <ul style="margin:10px 0 0;padding:0;list-style:none">
        ${role.services.map(s=>`<li style="padding:6px 0;display:flex;justify-content:space-between"><span>${s.ar} · <small>${s.en}</small></span><button class="btn" data-role="${role.id}" data-srv="${s.id}">فتح</button></li>`).join('')}
      </ul>`;
    grid.appendChild(card);
  });
  grid.querySelectorAll('button[data-srv]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      if(!App.user){ openLogin(); return; }
      openService(btn.dataset.srv);
      location.hash = '#dashboard';
    });
  });
});

// KPIs
fetch('data/KPIs.json').then(r=>r.json()).then(K=>{
  function setProfile(p){
    const b = K[p]||K.national;
    document.getElementById('kpi-employment').textContent = `+${b.employment}%`;
    document.getElementById('kpi-integration').textContent = `${b.integration}%`;
    document.getElementById('kpi-projects').textContent = b.projects.toLocaleString('en-US');
    // Bars
    document.getElementById('bar-1').style.width = (50 + Math.random()*30)+'%';
    document.getElementById('bar-2').style.width = (40 + Math.random()*30)+'%';
    document.getElementById('bar-3').style.width = (30 + Math.random()*30)+'%';
  }
  document.getElementById('kpiProfile').addEventListener('change', e=> setProfile(e.target.value));
  setProfile('national');
});

// Tabs
document.querySelectorAll('.tabbar .tab').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tabbar .tab').forEach(b=>b.classList.remove('active'));
    t.classList.add('active');
    ['tab-overview','tab-initiatives','tab-opps'].forEach(id=> document.getElementById(id).style.display='none');
    document.getElementById(t.dataset.tab).style.display='block';
  });
});

// Login/Signup handlers
document.getElementById('loginForm').addEventListener('submit', e=>{
  e.preventDefault();
  const emailOrName = e.target.emailOrName.value.trim();
  const pw = e.target.password.value.trim();
  const role = e.target.role.value;
  if(emailOrName.includes('@') && pw){
    const u = App.users.find(u=>u.email===emailOrName && u.pw===btoa(pw));
    if(!u){ alert('بيانات الدخول غير صحيحة'); return; }
    App.user = {name:u.name, email:u.email, role:u.role, region:u.region||''};
  } else {
    App.user = {name:emailOrName || 'ضيف', role};
  }
  App.save();
  document.getElementById('userName').textContent = App.user.name;
  document.getElementById('userRole').textContent = App.user.role;
  closeModal('modal-login');
  location.hash = '#dashboard';
  renderServices(); updateStats(); renderOpps(); renderList();
});
document.getElementById('signupForm').addEventListener('submit', e=>{
  e.preventDefault();
  const fd = new FormData(e.target); const data = Object.fromEntries(fd.entries());
  if(App.users.some(u=>u.email===data.email)){ alert('البريد مسجّل'); return; }
  data.pw = btoa(data.password); delete data.password;
  App.users.push(data); App.user = {name:data.name,email:data.email,role:data.role,region:data.region||''}; App.save();
  document.getElementById('userName').textContent = App.user.name;
  document.getElementById('userRole').textContent = App.user.role;
  closeModal('modal-signup');
  location.hash = '#dashboard';
  renderServices(); updateStats(); renderOpps(); renderList();
});

// Workspace services (role actions)
function openService(id){
  const box = document.getElementById('service-workspace');
  box.style.display='block';
  let html = `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
    <b>${id}</b><button class="btn" id="closeWS">×</button>
  </div>`;
  switch(id){
    case 'add-initiative':
      html += `<form id="ws-add-init" class="grid grid-2">
        <input placeholder="اسم المبادرة" required/>
        <select><option>تعليمي</option><option>ثقافي</option><option>اجتماعي</option><option>اقتصادي</option></select>
        <textarea class="grid-col-span-2" placeholder="وصف مختصر" required></textarea>
        <button class="btn btn-primary">حفظ</button>
      </form>`;
      break;
    case 'csr-report':
      html += `<form id="ws-csr" class="grid grid-3">
        <input placeholder="المنشأة" required/>
        <input placeholder="الفترة (2025-Q4)" required/>
        <input placeholder="حجم الإنفاق (ر.س)" required/>
        <textarea class="grid-col-span-3" placeholder="ملاحظات/ربط مشاريع"></textarea>
        <button class="btn btn-primary grid-col-span-3">توليد مسودة</button>
      </form>`;
      break;
    case 'sponsor':
      html += `<form id="ws-sponsor" class="grid grid-2">
        <input placeholder="اسم الفعالية" required/>
        <input placeholder="الجهة المنظمة" required/>
        <input placeholder="التاريخ"/>
        <input placeholder="المدينة"/>
        <button class="btn btn-primary grid-col-span-2">إرسال الطلب</button>
      </form>`;
      break;
    case 'publish-opps':
      html += `<form id="ws-opp" class="grid grid-3">
        <input placeholder="عنوان الفرصة" required/>
        <select><option>وظيفة</option><option>تطوع</option><option>تدريب</option></select>
        <input placeholder="القطاع/الفئة"/>
        <textarea class="grid-col-span-3" placeholder="وصف مختصر"></textarea>
        <button class="btn btn-primary grid-col-span-3">نشر</button>
      </form>`;
      break;
    case 'manage-projects':
      html += `<div id="ws-projects" class="grid"></div>
      <form id="ws-add-proj" class="grid grid-3">
        <input placeholder="اسم المشروع" required/>
        <select><option>قيد التخطيط</option><option>قيد التنفيذ</option><option>مكتمل</option></select>
        <button class="btn btn-primary">إضافة</button>
      </form>`;
      break;
    case 'academic-review':
      html += `<form id="ws-acad" class="grid">
        <input placeholder="عنوان الدراسة" required/>
        <textarea placeholder="ملخص"></textarea>
        <button class="btn btn-primary">إصدار مسودة اعتماد</button>
      </form>`;
      break;
    case 'coop-training':
      html += `<form id="ws-coop" class="grid grid-2">
        <input placeholder="المسمّى" required/>
        <input placeholder="المدة (أسابيع)"/>
        <button class="btn btn-primary grid-col-span-2">نشر</button>
      </form>`;
      break;
    case 'approve-events':
      html += `<div id="ws-events" class="grid"></div>`;
      break;
    case 'request-solutions':
      html += `<form id="ws-sol" class="grid grid-2">
        <input placeholder="عنوان التحدي" required/>
        <textarea class="grid-col-span-2" placeholder="التفاصيل"></textarea>
        <button class="btn btn-primary grid-col-span-2">نشر الطلب</button>
      </form>`;
      break;
    case 'regional-dashboard':
      html += `<div class="grid grid-3">
        <div class="card"><small>مبادرات</small><div class="value" id="rg-init">0</div></div>
        <div class="card"><small>وظائف/تطوع</small><div class="value" id="rg-opps">0</div></div>
        <div class="card"><small>مشاريع</small><div class="value" id="rg-proj">0</div></div>
      </div>`;
      break;
    case 'approve-initiatives':
      html += `<div id="ws-approve" class="grid"></div>`;
      break;
    case 'grant-portfolio':
      html += `<div class="grid grid-3">
        <div class="card"><small>إجمالي التمويل</small><div class="value">1.2م</div></div>
        <div class="card"><small>مشاريع نشطة</small><div class="value">7</div></div>
        <div class="card"><small>مكتملة</small><div class="value">12</div></div>
      </div>`;
      break;
    case 'find-projects':
      html += `<form id="ws-find" class="grid grid-3">
        <select><option>تعليمي</option><option>ثقافي</option><option>اجتماعي</option><option>اقتصادي</option></select>
        <input placeholder="المنطقة"/>
        <button class="btn btn-primary">بحث</button>
      </form><div id="ws-results" class="grid" style="margin-top:8px"></div>`;
      break;
    default:
      html += `<small>الخدمة غير معرّفة بعد.</small>`;
  }
  box.innerHTML = html;

  document.getElementById('closeWS').onclick = ()=>{ box.style.display='none'; box.innerHTML=''; };
  if(document.getElementById('ws-opp')){
    document.getElementById('ws-opp').onsubmit = (e)=>{ e.preventDefault(); alert('تم النشر (تجريبي)'); };
  }
  if(document.getElementById('ws-events')){
    const host=document.getElementById('ws-events'); ['مهرجان صيفي','ملتقى التطوع','معرض الجامعات'].forEach(n=>{
      const c=document.createElement('div'); c.className='card'; c.innerHTML=`<div style="display:flex;justify-content:space-between"><div>${n}</div><div><button class="btn">قبول</button> <button class="btn">رفض</button></div></div>`; host.appendChild(c);
    });
  }
  if(document.getElementById('ws-approve')){
    const host=document.getElementById('ws-approve'); (App.initiatives||[]).forEach(it=>{
      if(it.status==='قيد المراجعة'){
        const c=document.createElement('div'); c.className='card'; c.innerHTML=`<div style="display:flex;justify-content:space-between"><div>${it.name}</div><button class="btn btn-primary">اعتماد</button></div>`;
        c.querySelector('button').onclick=()=>{ it.status='معتمد'; localStorage.setItem('initiatives', JSON.stringify(App.initiatives)); c.remove(); alert('تم الاعتماد'); };
        host.appendChild(c);
      }
    });
  }
}

// Role services cards (per user)
const servicesByRole = {
  individual:[{id:'add-initiative',title:'إضافة مبادرة'}],
  private:[{id:'csr-report',title:'تقرير المسؤولية CSR'},{id:'sponsor',title:'رعاية فعالية'}],
  nonprofit:[{id:'publish-opps',title:'نشر فرص'},{id:'manage-projects',title:'إدارة المشاريع'}],
  university:[{id:'academic-review',title:'تعزيز علمي'},{id:'coop-training',title:'تدريب تعاوني'}],
  government:[{id:'approve-events',title:'اعتماد الفعاليات'},{id:'request-solutions',title:'طلب حلول'}],
  emirate:[{id:'regional-dashboard',title:'لوحة المنطقة'},{id:'approve-initiatives',title:'اعتماد مبادرات'}],
  funder:[{id:'grant-portfolio',title:'محفظة المنح'},{id:'find-projects',title:'اعثر على مشاريع'}]
};
function renderServices(){
  const grid = document.getElementById('role-services'); if(!grid) return;
  grid.innerHTML = '';
  if(!App.user){ grid.innerHTML = '<small style="color:var(--gray)">سجّل الدخول أولًا لعرض الخدمات</small>'; return; }
  (servicesByRole[App.user.role]||[]).forEach(s=>{
    const d=document.createElement('div'); d.className='card';
    d.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><b>${s.title}</b><button class="btn" data-srv="${s.id}">فتح</button></div>`;
    d.querySelector('button').onclick = ()=>openService(s.id);
    grid.appendChild(d);
  });
}

// Initiatives
App.initiatives = JSON.parse(localStorage.getItem('initiatives')||'[]');
document.getElementById('form-initiative').addEventListener('submit', e=>{
  e.preventDefault();
  const [name,cat,desc,b1,b2,b3] = Array.from(e.target.querySelectorAll('input,select,textarea')).map(el=>el.value);
  const item = {id:Date.now(), name, cat, desc, blocks:{b1,b2,b3}, status:'قيد المراجعة'};
  App.initiatives.push(item); localStorage.setItem('initiatives', JSON.stringify(App.initiatives));
  e.target.reset(); renderList(); updateStats(); alert('تم الحفظ');
});
function renderList(){
  const wrap = document.getElementById('list-initiatives'); if(!wrap) return; wrap.innerHTML='';
  if(!App.initiatives.length){ wrap.innerHTML = '<small style="color:var(--gray)">لا توجد مبادرات بعد.</small>'; return; }
  App.initiatives.slice().reverse().forEach(it=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><b>${it.name}</b><span class="badge">${it.status}</span></div>
      <small style="color:var(--gray)">${it.cat} • ${it.desc}</small>
      <div class="grid grid-3">
        <div class="card">${it.blocks.b1||'-'}</div>
        <div class="card">${it.blocks.b2||'-'}</div>
        <div class="card">${it.blocks.b3||'-'}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" data-act="approve">اعتماد</button>
        <button class="btn" data-act="delete">حذف</button>
      </div>`;
    card.querySelector('[data-act="delete"]').onclick=()=>{ App.initiatives = App.initiatives.filter(x=>x.id!==it.id); localStorage.setItem('initiatives', JSON.stringify(App.initiatives)); renderList(); updateStats(); };
    card.querySelector('[data-act="approve"]').onclick=()=>{ it.status='معتمد'; localStorage.setItem('initiatives', JSON.stringify(App.initiatives)); renderList(); };
    wrap.appendChild(card);
  });
}
function updateStats(){
  const total = App.initiatives.length; const pending = App.initiatives.filter(i=>i.status==='قيد المراجعة').length; const opps = App.opps.length;
  document.getElementById('stat-initiatives').textContent = total;
  document.getElementById('stat-pending').textContent = pending;
  document.getElementById('stat-opps').textContent = opps;
}
function renderOpps(){
  const wrap = document.getElementById('list-opps'); if(!wrap) return; wrap.innerHTML='';
  App.opps.forEach(o=>{ const d=document.createElement('div'); d.className='card'; d.innerHTML=`<b>${o.title}</b><small style="color:var(--gray)">${o.kind}</small>`; wrap.appendChild(d); });
}

// Init
(function init(){
  // restore session
  if(App.user){ document.getElementById('userName').textContent = App.user.name; document.getElementById('userRole').textContent = App.user.role; }
  renderServices(); renderList(); updateStats(); renderOpps();
  applyLang('ar');
})();
</script>
</body>
</html>
